import pymongo
import json
import operator
import pandas as pd
import random
import numpy as np
import matplotlib.tri as tri
import time


def nosqlsÃ¸k():
    myclient = pymongo.MongoClient("mongodb://localhost:27017/")
    mydb = myclient["Geodata"]
    mycol = mydb["test"]
    cu=list(mydb.hundreogeleve.find().limit(1).sort([("_id",pymongo.DESCENDING)]))
    Tall=cu[0]["_id"]
    liste=[]
    nyliste={}
    nyliste['x']=[]
    nyliste['y']=[]
    nyliste['z']=[]
    for i in range(0,Tall,100000):
        liste.append(list(mydb.hundreogeleve.find({"_id":i})))
            
    
    for x in range(0,len(liste)) :
       nyliste['z'].append(liste[x][0]["z"])
       nyliste['x'].append(liste[x][0]["x"])
       nyliste['y'].append(liste[x][0]["y"])
    print(nyliste)
def asctojson():
    liste=["231","232"]
    for s in range(0,len(liste)):
        fil16=pd.read_fwf("txtfiler/"+liste[s]+".asc",header=None)
        x=[]
        y=[]
        z=[]
        x=fil16[0]
        y=fil16[1]
        z=fil16[2]
        coords={}
        coords['x']=[]
        coords['y']=[]
        coords['z']=[]


        for i in range(x.__len__()):
       
                coords['x'].append(x[i])
                coords['y'].append(y[i])
                coords['z'].append(z[i])
        with open('txtfiler/'+liste[s]+'.json','w')as outfile:
            json.dump(coords,outfile)


def dbinsertion():
 
    myclient = pymongo.MongoClient("mongodb://localhost:27017/")
    mydb = myclient["Geodata"]
    ruteset=dbrute()
    x=0
    for p in ruteset:
        print(p)
        with open('txtfiler/'+str(p)+'.json') as json_file:
            data=json.load(json_file)

        for s in range(0,len(ruteset[p])):
            
            print(ruteset[p][s])
            testrute=dbrute()
            rutenr=testrute[p][s]
            name="d"+str(rutenr)
            mycol = mydb[name]
            
    
            rute=rutenett()
            ruter=rute[rutenr]
            xst=ruter[1]-0.01
            xsl=ruter[0]+0.01
            yst=ruter[2]+0.01
            ysl=ruter[3]-0.01
    

            startid=0
            if mydb[name+"z0"].count()>0:
                r=0
            else:
                r=1
            if r==0:

                for i in range(0,11):
                    if mydb[name+"z"+str(i)].count()>0:

                        cu=list( mydb[name+"z"+str(i)].find().limit(1).sort([("_id",pymongo.DESCENDING)]))
                        if cu[0]["_id"]>startid:
                         startid=cu[0]["_id"]
                        teller=startid+1

            else:
                teller=0
            nyliste={}
            nyliste['_id']=[]
            nyliste['x']=[]
            nyliste['y']=[]
            nyliste['z']=[]
            nyliste['zoom']=[]



            for i in range(0,len(data['x'])):
                if data['x'][i]<xst and data['x'][i]>xsl and data['y'][i]>yst and data['y'][i]<ysl:  
          
                  if teller %2000==0:
                      x = mydb[name+"z0"].insert({"_id":teller, "x":data['x'][i],"y":data['y'][i],"z":data['z'][i]})
                  elif teller %1000==0:
                      x = mydb[name+"z1"].insert({"_id":teller, "x":data['x'][i],"y":data['y'][i],"z":data['z'][i]})
                  elif teller % 500==0:
                      x = mydb[name+"z2"].insert({"_id":teller, "x":data['x'][i],"y":data['y'][i],"z":data['z'][i]})
                  elif teller % 250==0:
                      x = mydb[name+"z3"].insert({"_id":teller, "x":data['x'][i],"y":data['y'][i],"z":data['z'][i]})
                  elif teller % 125==0:
                      x = mydb[name+"z4"].insert({"_id":teller, "x":data['x'][i],"y":data['y'][i],"z":data['z'][i]})
                  elif teller % 62==0:
                      x = mydb[name+"z5"].insert({"_id":teller, "x":data['x'][i],"y":data['y'][i],"z":data['z'][i]})
                  elif teller % 30==0:
                      x = mydb[name+"z6"].insert({"_id":teller, "x":data['x'][i],"y":data['y'][i],"z":data['z'][i]})
                  elif teller % 15==0:
                      x = mydb[name+"z7"].insert({"_id":teller, "x":data['x'][i],"y":data['y'][i],"z":data['z'][i]})
                  elif teller % 7==0:
                      x = mydb[name+"z8"].insert({"_id":teller, "x":data['x'][i],"y":data['y'][i],"z":data['z'][i]})
                  elif teller % 4==0:
                      x = mydb[name+"z9"].insert({"_id":teller, "x":data['x'][i],"y":data['y'][i],"z":data['z'][i]})
                  elif teller % 1==0:
                      x = mydb[name+"z10"].insert({"_id":teller, "x":data['x'][i],"y":data['y'][i],"z":data['z'][i]})
                  teller+=1
          
def sok():
    myclient = pymongo.MongoClient("mongodb://localhost:27017/")
    mydb = myclient["Geodata"]
    mycol = mydb["test"]
    start_time = time.time()
  
    xstart=list(mydb.d48z10.find({"x":{"$gt":6538100,"$lt":6538200},"y":{"$lt":306100,"$gt":306000}}))
    print(len(xstart))
   
    print("--- %s seconds ---" % (time.time() - start_time))
    

   
def rutenett():

    ruter={1:[6534800,6535000,305600,305800],2:[6535000,6535200,305600,305800],3:[6535200,6535400,305600,305800],4:[6535400,6535600,305600,305800],5:[6535600,6535800,305600,305800],
           6:[6535800,6536000,305600,305800],7:[6536000,6536200,305600,305800],8:[6536200,6536400,305600,305800],9:[6537400,6537600,305600,305800],10:[6534000,6534200,305800,306000],
           11:[6534200,6534400,305800,306000],12:[6534400,6534600,305800,306000],13:[6534600,6534800,305800,306000],14:[6534800,6535000,305800,306000],15:[6534800,6535000,305800,306000],
           16:[6535000,6535200,305800,306000],17:[6535200,6535400,305800,306000],18:[6535400,6535600,305800,306000],19:[6535600,6535800,305800,306000],20:[6535800,6536000,305800,306000],
           21:[6536000,6536200,305800,306000],22:[6536200,6536400,305800,306000],23:[6536400,6536600,305800,306000],24:[6537400,6537600,305800,306000],25:[6537600,6537800,305800,306000],
           26:[6537800,6538000,305800,306000],27:[6538000,6538200,305800,306000],28:[6533600,6533800,306000,306200],29:[6533800,6534000,306000,306200],30:[6534000,6534200,306000,306200],
           31:[6534200,6534400,306000,306200],32:[6534400,6534600,306000,306200],33:[6534600,6534800,306000,306200],34:[6534800,6535000,306000,306200],35:[6535000,6535200,306000,306200],
           36:[6535200,6535400,306000,306200],37:[6535400,6535600,306000,306200],38:[6535600,6535800,306000,306200],39:[6535800,6536000,306000,306200],40:[6536000,6536200,306000,306200],
           41:[6536200,6536400,306000,306200],42:[6536400,6536600,306000,306200],43:[6536600,6536800,306000,306200],44:[6537200,6537400,306000,306200],45:[6537400,6537600,306000,306200],
           46:[6537600,6537800,306000,306200],47:[6537800,6538000,306000,306200],48:[6538000,6538200,306000,306200],49:[6533600,6533800,306200,306400],50:[6533800,6534000,306200,306400],
           51:[6534000,6534200,306200,306400],52:[6534200,6534400,306200,306400],53:[6534400,6534600,306200,306400],54:[6534600,6534800,306200,306400],55:[6534800,6535000,306200,306400],
           56:[6535000,6535200,306200,306400],57:[6535200,6535400,306200,306400],58:[6535400,6535600,306200,306400],59:[6535600,6535800,306200,306400],60:[6535800,6536000,306200,306400],
           61:[6536000,6536200,306200,306400],62:[6536200,6536400,306200,306400],63:[6536400,6536600,306200,306400],64:[6536600,6536800,306200,306400],65:[6536800,6537000,306200,306400],
           66:[6537000,6537200,306200,306400],67:[6537200,6537400,306200,306400],68:[6537400,6537600,306200,306400],69:[6537600,6537800,306200,306400],70:[6537800,6538000,306200,306400],
           71:[6538000,6538200,306200,306400],72:[6533600,6533800,306400,306600],73:[6533800,6534000,306400,306600],74:[6534000,6534200,306400,306600],75:[6534200,6534400,306400,306600],
           76:[6534400,6534600,306400,306600],77:[6534600,6534800,306400,306600],78:[6534800,6535000,306400,306600],79:[6535000,6535200,306400,306600],80:[6535200,6535400,306400,306600],
           81:[6535400,6535600,306400,306600],82:[6535600,6535800,306400,306600],83:[6535800,6536000,306400,306600],84:[6536000,6536200,306400,306600],85:[6536200,6536400,306400,306600],
           86:[6536400,6536600,306400,306600],87:[6536600,6536800,306400,306600],88:[6536800,6537000,306400,306600],89:[6537000,6537200,306400,306600],90:[6537200,6537400,306400,306600],
           91:[6537400,6537600,306400,306600],92:[6537800,6538000,306400,306600],93:[6538000,6538200,306400,306600],94:[6534400,6534600,306600,306800],95:[6534600,6534800,306600,306800],
           96:[6534800,6535000,306600,306800],97:[6535000,6535200,306600,306800],98:[6535200,6535400,306600,306800],99:[6535400,6535600,306600,306800],100:[6535600,6535800,306600,306800],
           101:[6536000,6536200,306600,306800],102:[6536200,6536400,306600,306800],103:[6536400,6536600,306600,306800],104:[6536600,6536800,306600,306800],105:[6536800,6537000,306600,306800],
           106:[6537000,6537200,306600,306800],107:[6537200,6537400,306600,306800],108:[6534600,6534800,306800,307000],109:[6534800,6535000,306800,307000],110:[6535000,6535200,306800,307000],
           111:[6535200,6535400,306800,307000],112:[6535400,6535600,306800,307000],113:[6535600,6535800,306800,307000],114:[6536000,6536200,306800,307000],115:[6536200,6536400,306800,307000],
           116:[6536400,6536600,306800,307000],117:[6536600,6536800,306800,307000],118:[6536800,6537000,306800,307000],119:[6537000,6537200,306800,307000],120:[6537200,6537400,306800,307000],
           121:[6534800,6535000,307000,307200],122:[6535000,6535200,307000,307200],123:[6535200,6535400,307000,307200],124:[6535400,6535600,307000,307200],125:[6535600,6535800,307000,307200],
           126:[6535800,6536000,307000,307200],127:[6536000,6536200,307000,307200],128:[6536200,6536400,307000,307200],129:[6536400,6536600,307000,307200],130:[6536600,6536800,307000,307200],
           131:[6536800,6537000,307000,307200],132:[6537000,6537200,307000,307200],133:[6537200,6537400,307000,307200],134:[6537400,6537600,307000,307200],135:[6535000,6535200,307200,307400],
           136:[6535200,6535400,307200,307400],137:[6535400,6535600,307200,307400],138:[6535600,6535800,307200,307400],139:[6535800,6536000,307200,307400],140:[6536000,6536200,307200,307400],
           141:[6536200,6536400,307200,307400],142:[6536400,6536600,307200,307400],143:[6536600,6536800,307200,307400],144:[6536800,6537000,307200,307400],145:[6537000,6537200,307200,307400],
           146:[6537200,6537400,307200,307400],147:[6537400,6537600,307200,307400],148:[6535000,6535200,307400,307600],149:[6535200,6535400,307400,307600],150:[6535400,6535600,307400,307600],
           151:[6535600,6535800,307400,307600],152:[6535800,6536000,307400,307600],153:[6536000,6536200,307400,307600],154:[6536200,6536400,307400,307600],155:[6536400,6536600,307400,307600],
           156:[6536600,6536800,307400,307600],157:[6536800,6537000,307400,307600],158:[6537000,6537200,307400,307600],159:[6537200,6537400,307400,307600],160:[6537400,6537600,307400,307600],
           161:[6537600,6537800,307400,307600],162:[6534800,6535000,307600,307800],163:[6535000,6535200,307600,307800],164:[6535200,6535400,307600,307800],165:[6535400,6535600,307600,307800],
           166:[6535600,6535800,307600,307800],167:[6535800,6536000,307600,307800],168:[6536000,6536200,307600,307800],169:[6536200,6536400,307600,307800],170:[6536400,6536600,307600,307800],
           171:[6536600,6536800,307600,307800],172:[6536800,6537000,307600,307800],173:[6537000,6537200,307600,307800],174:[6537200,6537400,307600,307800],175:[6537400,6537600,307600,307800],
           176:[6537600,6537800,307600,307800],177:[6537800,6538000,307600,307800],178:[6535200,6535400,307800,308000],179:[6535400,6535600,307800,308000],180:[6535600,6535800,307800,308000],
           181:[6535800,6536000,307800,308000],182:[6536000,6536200,307800,308000],183:[6536200,6536400,307800,308000],184:[6536400,6536600,307800,308000],185:[6536600,6536800,307800,308000],
           186:[6536800,6537000,307800,308000],187:[6537000,6537200,307800,308000],188:[6537200,6537400,307800,308000],189:[6537400,6537600,307800,308000],190:[6537600,6537800,307800,308000],
           191:[6537800,6538000,307800,308000],192:[6538000,6538200,307800,308000],193:[6535800,6536000,308000,308200],194:[6536000,6536200,308000,308200],195:[6536200,6536400,308000,308200],
           196:[6536400,6536600,308000,308200],197:[6536600,6536800,308000,308200],198:[6536800,6537000,308000,308200],199:[6537000,6537200,308000,308200],200:[6537200,6537400,308000,308200],
           201:[6537400,6537600,308000,308200],202:[6537600,6537800,308000,308000],203:[6537800,6538000,308000,308200],204:[6538000,6538200,308000,308200],205:[6536000,6536200,308200,308400],
           206:[6536200,6536400,308200,308400],207:[6536400,6536600,308200,308400],208:[6536600,6536800,308200,308400],209:[6536800,6537000,308200,308400],210:[6537000,6537200,308200,308400],
           211:[6537200,6537400,308200,308400],212:[6537400,6537600,308200,308400],213:[6537600,6537800,308200,308400],214:[6537800,6538000,308200,308400],215:[6538000,6538200,308200,308400],
           216:[6536200,6536400,308400,308600],217:[6536400,6536600,308400,308600],218:[6536600,6536800,308400,308600],219:[6536800,6537000,308400,308600],220:[6537000,6537200,308400,308600],
           221:[6537200,6537400,308400,308600],222:[6537400,6537600,308400,308600],223:[6537600,6537800,308400,308600],224:[6537800,6538000,308400,308600],225:[6538000,6538200,308400,308600],
           226:[6536600,6536800,308600,308800],227:[6536800,6537000,308600,308800],228:[6537000,6537200,308600,308800],229:[6537200,6537400,308600,308800],230:[6537400,6537600,308600,308800],
           231:[6537600,6537800,308600,308800],232:[6537800,6538000,308600,308800],233:[6538000,6538200,308600,308800],234:[6536600,6536800,308800,309000],235:[6536800,6537000,308800,309000],
           236:[6537000,6537200,308800,309000],237:[6537200,6537400,308800,309000],238:[6537400,6537600,308800,309000],239:[6537600,6537800,308800,309000]}
    irute={21:[9,26,25,24,46,45,44],110:[27,48,71,26,47,70,25,46],113:[25,24,26,47,46,45,69,68],114:[46,69,45,68,44,67,91,90,66,89],125:[69,68,91,67,90,66,89,88,65,107,106,105],
           185:[107,120,134,133,106,119,132,90,89],186:[133,134,132,145,161,160,159,177,176,175,174],66:[177,176,192,191,190,204,203,202,215,214,213],193:[204,203,215,214],194:[215,214,225,224],
           181:[225,224,233,212],191:[192,191,190,189,204,203,202,201,215,214,213,212,225,224,223,222],179:[224,212,223,231,239,222,230,238],180:[201,239,230,238],202:[230,238,229,237],201:[237,236,235,229,228,227],
           87:[213,223,212,222,211,221,210,220,231,230,229,228],158:[175,174,173,172,189,188,187,186,201,200,199,198,212,211,210,209],124:[66,65,64,89,88,87],160:[89,88,87,106,105,104,119,118,117,132,131,130,145,144,143],
           159:[145,144,143,142,158,157,156,155,173,172,171,170,187,186,185,184,199,198,197,196,210,209,208,207],206:[210,209,220,219],204:[210,218,227,226],97:[235,234],205:[218,217,208,207],85:[217,216,207,206],
           74:[207,206,205,196,195,194,193,184,183,182,181],157:[184,183,182,181,170,169,168,167,155,154,153,152,142,141,140,139],155:[129,128,130,117,116,115,114],134:[117,116,115,114,104,103,102,101],
           133:[104,103,102,101,87,86,85,84,64,63,62,61],132:[64,63,62,61,43,42,41],131:[43,42,41,23,22,21],130:[43,42,41,23,22,21],119:[23,43],198:[8,7,21,20],190:[21,20,41,40,62,61],152:[62,61,85,84,102,101],
           150:[102,101,115,114,128,127],144:[128,127,141,140,154,153,169,168,183,182,195,194],138:[206,205,216],137:[181,180,179,167,166,165],143:[167,166,165,152,151,139,138],149:[126,125,124,113,112,100,99],
           151:[83,82,81,61,60,59,39,38,37],189:[39,38,37,19,18,17],197:[6,5],210:[4,3,2,1],220:[17,16,37,36,58,57],39:[58,57,56,55,81,80,79,78,99,98,97,96],50:[112,111,110,109,124,123,122,121,137,136,135],
           136:[150,149,164,163],140:[179,178],135:[149,148,164,163,162],49:[122,121,110,109,108],38:[110,109,108,97,96,95,94,79,78,77,76,56,55,54,53],232:[2,3,16,15],231:[1,2,14,15],226:[36,35,34,57,56,55],
           218:[14,13,12,34,33,32],84:[34,33,32,55,54,53],38:[55,54,53,52,78,77,76,75,96,95,94],49:[108,109,121],217:[12,11,32,31],214:[11,10,31,30,52,51],213:[10,30,29,51,50],37:[54,53,52,51,50,77,76,75,74,73],
           212:[29,28,50,49],210:[50,49,73,72]}

    return(ruter)
def dbrute():
     irute={38:[55,54,53,52,78,77,76,75,96,95,94],49:[108,109,121],217:[12,11,32,31],214:[11,10,31,30,52,51],213:[10,30,29,51,50],37:[54,53,52,51,50,77,76,75,74,73],
           212:[29,28,50,49],210:[50,49,73,72]}
     return irute
dbinsertion()